import{a as M,b as y}from"./chunk-H73OQI6D.js";import{a as ee}from"./chunk-77SYAVCL.js";import{c as te,d as ie,e as ne,f as re,g as oe,h as ae,i as se,j as le,k as de,m as ce,n as pe}from"./chunk-LYQVR4D2.js";import"./chunk-D4VGNZLR.js";import"./chunk-JHLW7V75.js";import"./chunk-QQGZZJ5C.js";import{a as z,e as Y,k as q}from"./chunk-PJ4DBHJV.js";import{a as G}from"./chunk-F6L3CC75.js";import{F as k,K as W,N as T,S as D}from"./chunk-HLI2QS3U.js";import{$ as x,$a as J,Da as B,H as n,I as S,Ja as F,K as V,Oa as U,P as h,S as u,Sa as H,U as r,V as o,W as I,X as A,Y as L,Ya as j,Za as K,_ as v,_a as Z,aa as l,ab as Q,db as X,eb as $,ha as N,ia as s,ja as _,ka as C,ma as w,na as E,oa as P,ra as c,sa as p,ua as O,w as m,x as g}from"./chunk-GCV73WN4.js";import"./chunk-4U6PRYVA.js";import"./chunk-BBW2JLGN.js";import"./chunk-B7L6ZJ5P.js";import"./chunk-KLLAU2Z6.js";import"./chunk-MGGEGWLF.js";import"./chunk-OAACOBQM.js";import"./chunk-JWIEPCRG.js";import"./chunk-HUAH4PE6.js";import"./chunk-SV7S5NYR.js";import"./chunk-C5RQ2IC2.js";import{g as R}from"./chunk-OLRFWS6T.js";function me(a,f){if(a&1&&(r(0,"ion-text",25),s(1),c(2,"translate"),o()),a&2){let t=l(2);n(),_(p(2,1,t.emailError))}}function ge(a,f){if(a&1&&(r(0,"ion-text",25),s(1),c(2,"translate"),o()),a&2){let t=l(2);n(),_(p(2,1,t.passwordError))}}function _e(a,f){if(a&1&&(r(0,"ion-text",25),s(1),c(2,"translate"),o()),a&2){let t=l(2);n(),_(p(2,1,t.confirmPasswordError))}}function fe(a,f){if(a&1&&(r(0,"ion-text",25),s(1),c(2,"translate"),o()),a&2){let t=l(2);n(),_(p(2,1,t.error))}}function ue(a,f){a&1&&(r(0,"p",29),s(1," (Mode test : pour cr\xE9er un compte, configurez une vraie cl\xE9 API Firebase dans environment.ts) "),o())}function xe(a,f){if(a&1&&(r(0,"ion-text",26)(1,"p",27),s(2),o(),h(3,ue,2,0,"p",28),o()),a&2){let t=l(2);n(2),_(t.errorRaw),n(),u("ngIf",t.errorRaw.includes("api-key-not-valid"))}}function he(a,f){if(a&1){let t=v();A(0),r(1,"form",6,1),x("ngSubmit",function(){m(t);let e=l();return g(e.onSubmit())}),r(3,"div",7),I(4,"img",8),r(5,"div",9),s(6),c(7,"translate"),r(8,"a",10),s(9,"www.sunshine-adventures.net"),o()()(),r(10,"ion-item")(11,"ion-label"),s(12),c(13,"translate"),o(),r(14,"ion-select",11),P("ngModelChange",function(e){m(t);let d=l();return E(d.preferredLang,e)||(d.preferredLang=e),g(e)}),x("ionChange",function(){m(t);let e=l();return g(e.onPreferredLangChange())}),r(15,"ion-select-option",12),s(16,"Fran\xE7ais"),o(),r(17,"ion-select-option",13),s(18,"English"),o()()(),r(19,"ion-item")(20,"ion-label",14),s(21),c(22,"translate"),o(),r(23,"ion-input",15),P("ngModelChange",function(e){m(t);let d=l();return E(d.email,e)||(d.email=e),g(e)}),x("ionBlur",function(){m(t);let e=l();return g(e.validateEmailField())})("ngModelChange",function(){m(t);let e=l();return g(e.validateEmailField())}),o()(),h(24,me,3,3,"ion-text",16),r(25,"ion-item")(26,"ion-label",14),s(27),c(28,"translate"),o(),r(29,"ion-input",17),P("ngModelChange",function(e){m(t);let d=l();return E(d.password,e)||(d.password=e),g(e)}),x("ionBlur",function(){m(t);let e=l();return g(e.validatePasswordField())})("ngModelChange",function(){m(t);let e=l();return e.validatePasswordField(),g(e.validateConfirmPasswordField())}),o(),r(30,"ion-button",18),x("click",function(){m(t);let e=l();return g(e.togglePasswordVisibility())}),I(31,"ion-icon",19),o()(),h(32,ge,3,3,"ion-text",16),r(33,"ion-item")(34,"ion-label",14),s(35),c(36,"translate"),o(),r(37,"ion-input",20),P("ngModelChange",function(e){m(t);let d=l();return E(d.confirmPassword,e)||(d.confirmPassword=e),g(e)}),x("ionBlur",function(){m(t);let e=l();return g(e.validateConfirmPasswordField())})("ngModelChange",function(){m(t);let e=l();return g(e.validateConfirmPasswordField())}),o(),r(38,"ion-button",18),x("click",function(){m(t);let e=l();return g(e.toggleConfirmPasswordVisibility())}),I(39,"ion-icon",19),o()(),h(40,_e,3,3,"ion-text",16),r(41,"ion-item")(42,"ion-label",14),s(43),c(44,"translate"),o(),r(45,"ion-input",21),P("ngModelChange",function(e){m(t);let d=l();return E(d.firstName,e)||(d.firstName=e),g(e)}),o()(),r(46,"ion-item")(47,"ion-label",14),s(48),c(49,"translate"),o(),r(50,"ion-input",22),P("ngModelChange",function(e){m(t);let d=l();return E(d.lastName,e)||(d.lastName=e),g(e)}),o()(),h(51,fe,3,3,"ion-text",16)(52,xe,4,2,"ion-text",23),r(53,"ion-button",24),s(54),c(55,"translate"),o()(),L()}if(a&2){let t=l();n(6),C(" ",p(7,24,"HOME.BASELINE")," "),n(6),_(p(13,26,"AUTH.PREFERRED_LANG")),n(2),w("ngModel",t.preferredLang),n(7),_(p(22,28,"AUTH.EMAIL")),n(2),w("ngModel",t.email),n(),u("ngIf",t.emailError),n(3),_(p(28,30,"AUTH.PASSWORD")),n(2),u("type",t.showPassword?"text":"password"),w("ngModel",t.password),n(2),u("name",t.showPassword?"eye-off":"eye"),n(),u("ngIf",t.passwordError),n(3),_(p(36,32,"AUTH.CONFIRM_PASSWORD")),n(2),u("type",t.showConfirmPassword?"text":"password"),w("ngModel",t.confirmPassword),n(2),u("name",t.showConfirmPassword?"eye-off":"eye"),n(),u("ngIf",t.confirmPasswordError),n(3),_(p(44,34,"AUTH.FIRSTNAME")),n(2),w("ngModel",t.firstName),n(3),_(p(49,36,"AUTH.LASTNAME")),n(2),w("ngModel",t.lastName),n(),u("ngIf",t.error),n(),u("ngIf",t.errorRaw),n(),u("disabled",!t.isFormValid()||t.isLoading),n(),_(p(55,38,"AUTH.REGISTER"))}}function we(a,f){a&1&&(r(0,"ion-text",33),s(1),c(2,"translate"),o()),a&2&&(n(),_(p(2,1,"AUTH.VERIFY_EMAIL_SENT")))}function Ee(a,f){a&1&&(r(0,"ion-text",33),s(1),c(2,"translate"),o()),a&2&&(n(),_(p(2,1,"AUTH.VERIFY_EMAIL_SUCCESS")))}function Pe(a,f){if(a&1){let t=v();r(0,"div",30)(1,"h2"),s(2),c(3,"translate"),o(),r(4,"p"),s(5),c(6,"translate"),r(7,"b"),s(8),o()(),r(9,"ion-button",31),x("click",function(){m(t);let e=l();return g(e.resendVerification())}),s(10),c(11,"translate"),o(),h(12,we,3,3,"ion-text",32)(13,Ee,3,3,"ion-text",32),o()}if(a&2){let t=l();n(2),_(p(3,7,"AUTH.VERIFY_EMAIL_TITLE")),n(3),C("",p(6,9,"AUTH.VERIFY_EMAIL_MSG")," "),n(3),_(t.email),n(),u("disabled",t.isLoading),n(),C(" ",p(11,11,"AUTH.RESEND_VERIFICATION")," "),n(2),u("ngIf",t.verificationSent),n(),u("ngIf",t.verificationSuccess)}}var Fe=(()=>{let f=class f{constructor(i,e,d,b){this.auth=i,this.firestore=e,this.router=d,this.translate=b,this.email="",this.password="",this.confirmPassword="",this.firstName="",this.lastName="",this.preferredLang="fr",this.error="",this.errorRaw="",this.isLoading=!1,this.showPassword=!1,this.showConfirmPassword=!1,this.emailError="",this.passwordError="",this.confirmPasswordError="",this.verificationSent=!1,this.awaitingVerification=!1,this.verificationSuccess=!1}ngOnInit(){this.awaitingVerification&&this.startVerificationPolling()}ngOnDestroy(){this.verificationInterval&&clearInterval(this.verificationInterval)}startVerificationPolling(){this.verificationInterval=setInterval(()=>R(this,null,function*(){var i,e;yield(i=this.auth.currentUser)==null?void 0:i.reload(),(e=this.auth.currentUser)!=null&&e.emailVerified&&(this.verificationSuccess=!0,clearInterval(this.verificationInterval),setTimeout(()=>{this.router.navigate(["/auth/email"],{queryParams:{verified:"1"}})},1500))}),3e3)}validateEmailField(){this.email?this.isValidEmail(this.email)?this.emailError="":this.emailError="AUTH.ERRORS.INVALID_EMAIL":this.emailError="AUTH.ERRORS.EMPTY_FIELDS"}validatePasswordField(){this.password?M(this.password)?this.passwordError="":this.passwordError="AUTH.ERRORS.PASSWORD_RULES":this.passwordError="AUTH.ERRORS.EMPTY_FIELDS"}validateConfirmPasswordField(){y(this.password,this.confirmPassword)?this.confirmPasswordError="":this.confirmPasswordError="AUTH.ERRORS.PASSWORD_MISMATCH"}isFormValid(){return!!this.email&&!!this.password&&!!this.confirmPassword&&!!this.firstName&&!!this.lastName&&!this.emailError&&!this.passwordError&&!this.confirmPasswordError&&this.isValidEmail(this.email)&&M(this.password)&&y(this.password,this.confirmPassword)}onSubmit(){return R(this,null,function*(){if(this.error="",this.errorRaw="",this.validateEmailField(),this.validatePasswordField(),this.validateConfirmPasswordField(),!this.isFormValid()){this.error="AUTH.ERRORS.EMPTY_FIELDS",this.errorRaw="";return}this.isLoading=!0;try{console.log("[REGISTER] Starting user creation...");let i=yield W(this.auth,this.email,this.password);console.log("[REGISTER] User created successfully:",i.user.uid),console.log("[REGISTER] Updating profile..."),yield D(i.user,{displayName:`${this.firstName} ${this.lastName}`}),console.log("[REGISTER] Profile updated successfully"),console.log("[REGISTER] Saving user data to Firestore..."),yield q(Y(this.firestore,`users/${i.user.uid}`),{uid:i.user.uid,email:this.email,firstName:this.firstName,lastName:this.lastName,preferredLang:this.preferredLang,createdAt:new Date,lastLogin:new Date}),console.log("[REGISTER] User data saved to Firestore"),this.translate.use(this.preferredLang),localStorage.setItem("lang",this.preferredLang),console.log("[REGISTER] Sending verification email..."),yield T(i.user),console.log("[REGISTER] Verification email sent"),this.verificationSent=!0,this.awaitingVerification=!0,this.startVerificationPolling()}catch(i){console.error("[REGISTER ERROR]",i),i.code==="auth/email-already-in-use"?this.error="AUTH.ERRORS.EMAIL_IN_USE":i.code==="auth/invalid-email"?this.error="AUTH.ERRORS.INVALID_EMAIL":i.code==="auth/weak-password"?this.error="AUTH.ERRORS.WEAK_PASSWORD":i.code==="auth/configuration-not-found"?this.error="AUTH.ERRORS.CONFIG_NOT_FOUND":i.code==="auth/api-key-not-valid"?(this.error="AUTH.ERRORS.API_KEY_NOT_VALID",this.errorRaw=i.message):(this.error="AUTH.ERRORS.UNKNOWN",this.errorRaw=i.message||JSON.stringify(i))}finally{this.isLoading=!1}})}togglePasswordVisibility(){this.showPassword=!this.showPassword}toggleConfirmPasswordVisibility(){this.showConfirmPassword=!this.showConfirmPassword}isValidEmail(i){return/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/.test(i)}validateEmail(i){return this.isValidEmail(i)}resendVerification(){return R(this,null,function*(){this.auth.currentUser&&(yield T(this.auth.currentUser),this.verificationSent=!0)})}onPreferredLangChange(){this.translate.use(this.preferredLang),localStorage.setItem("lang",this.preferredLang)}};f.\u0275fac=function(e){return new(e||f)(S(k),S(z),S(H),S(G))},f.\u0275cmp=V({type:f,selectors:[["app-register-profile"]],decls:13,vars:5,consts:[["awaitingEmail",""],["registerForm","ngForm"],[1,"ion-padding"],[2,"text-align","center","margin-bottom","8px"],["color","warning"],[4,"ngIf","ngIfElse"],[3,"ngSubmit"],[2,"text-align","center","margin-bottom","16px"],["src","assets/bob/logo/bob-logo-circle.png","alt","BoB Logo",2,"height","70px","margin-bottom","8px"],[1,"bob-baseline"],["href","https://www.sunshine-adventures.net","target","_blank","rel","noopener"],["name","preferredLang","interface","popover",3,"ngModelChange","ionChange","ngModel"],["value","fr"],["value","en"],["position","floating"],["type","email","name","email","required","",3,"ngModelChange","ionBlur","ngModel"],["color","danger",4,"ngIf"],["name","password","required","",3,"ngModelChange","ionBlur","type","ngModel"],["fill","clear","slot","end","type","button",3,"click"],[3,"name"],["name","confirmPassword","required","",3,"ngModelChange","ionBlur","type","ngModel"],["name","firstName","required","",3,"ngModelChange","ngModel"],["name","lastName","required","",3,"ngModelChange","ngModel"],["color","medium",4,"ngIf"],["expand","block","type","submit",3,"disabled"],["color","danger"],["color","medium"],[1,"ion-text-center",2,"font-size","0.9em"],["class","ion-text-center","style","font-size: 0.9em; color: orange;",4,"ngIf"],[1,"ion-text-center",2,"font-size","0.9em","color","orange"],[1,"email-verification-container"],["expand","block",3,"click","disabled"],["color","success",4,"ngIf"],["color","success"]],template:function(e,d){if(e&1&&(r(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),s(3),c(4,"translate"),o()()(),r(5,"ion-content",2)(6,"div",3)(7,"ion-text",4)(8,"b"),s(9,"MODE TEST"),o()()(),h(10,he,56,40,"ng-container",5)(11,Pe,14,13,"ng-template",null,0,O),o()),e&2){let b=N(12);n(3),_(p(4,3,"AUTH.REGISTER_TITLE")),n(7),u("ngIf",!d.awaitingVerification)("ngIfElse",b)}},dependencies:[ne,de,le,ie,te,ce,re,oe,se,pe,ae,$,Q,j,K,X,J,Z,F,B,ee,U],styles:["ion-content[_ngcontent-%COMP%]{--background: none;background:url(/assets/bob/background/login_background.jpg) center center/cover no-repeat!important;min-height:100vh;display:flex;align-items:center;justify-content:center}form[_ngcontent-%COMP%]{max-width:400px;margin:48px auto;padding:32px 24px;background:#ffffffeb;border-radius:16px;box-shadow:0 2px 16px #00000014}ion-list[_ngcontent-%COMP%]{background:transparent;padding:0}ion-item[_ngcontent-%COMP%]{--background: transparent;--border-color: #1bb6b1;margin-bottom:16px}ion-button[_ngcontent-%COMP%]{--background: #1bb6b1;--background-hover: #159e9a;--background-activated: #159e9a;--color: #fff;--border-radius: 8px;margin-bottom:12px}ion-button[fill=outline][_ngcontent-%COMP%]{--background: #fff;--color: #1bb6b1;--border-color: #1bb6b1}ion-button[fill=clear][_ngcontent-%COMP%]{--color: #ff9800}ion-text[color=danger][_ngcontent-%COMP%]{margin-top:16px;display:block}.bob-baseline[_ngcontent-%COMP%]{font-size:1rem;color:#444;margin-bottom:16px;margin-top:8px}.bob-baseline[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:#1bb6b1}"]});let a=f;return a})();export{Fe as RegisterProfilePage};
