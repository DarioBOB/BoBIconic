import{a as $}from"./chunk-YWEJ7XCU.js";import{a as H}from"./chunk-77SYAVCL.js";import{a as k,c as P,d as S}from"./chunk-PJ4DBHJV.js";import{a as I}from"./chunk-PI2OKPQD.js";import"./chunk-AYIK34GE.js";import{F as z,f as L,h as R,i as j,j as B,k as D,l as F,n as N,x as G}from"./chunk-V5B2KLGN.js";import"./chunk-F6L3CC75.js";import{F as O}from"./chunk-HLI2QS3U.js";import{$ as _,Da as A,H as a,I as C,Ja as T,K as y,Ma as U,P as M,S as m,U as o,V as s,W as h,aa as w,ia as l,ja as d,ka as b,m as x,p as g,ra as u,sa as f}from"./chunk-GCV73WN4.js";import"./chunk-PTOT3QKV.js";import"./chunk-B5GAGNNW.js";import"./chunk-7CZIZFFD.js";import"./chunk-IFM5WRZ2.js";import"./chunk-HC6MZPB3.js";import"./chunk-IP3IRUG3.js";import"./chunk-EX3LFGLF.js";import"./chunk-RMJ7PCZJ.js";import"./chunk-OFKYDT3Y.js";import"./chunk-SJBLRW5X.js";import"./chunk-JFFBAPXU.js";import"./chunk-MCRJI3T3.js";import"./chunk-BBW2JLGN.js";import"./chunk-B7L6ZJ5P.js";import"./chunk-KLLAU2Z6.js";import"./chunk-MGGEGWLF.js";import"./chunk-OAACOBQM.js";import"./chunk-JWIEPCRG.js";import"./chunk-HUAH4PE6.js";import"./chunk-SV7S5NYR.js";import"./chunk-C5RQ2IC2.js";import"./chunk-K5LNJG62.js";import"./chunk-THTBSZJO.js";import"./chunk-GNOVVPTF.js";import"./chunk-BAKMWPBW.js";import"./chunk-5OMUW5VI.js";import"./chunk-OBXDPQ3V.js";import{a as E,b as v,g as p}from"./chunk-OLRFWS6T.js";var q=(()=>{let r=class r{constructor(i,e,t){this.firestore=i,this.auth=e,this.http=t,this.EMAIL_CONFIG={host:"imap.zoho.com",user:"bobplans@sunshine-adventures.net",password:I.zohoPassword,port:993}}parseUnreadEmails(){return p(this,null,function*(){var i;try{let e=yield this.http.post(`${I.apiUrl}/parse-emails`,{config:this.EMAIL_CONFIG}).toPromise();if(e!=null&&e.success&&e.trips.length>0){let t=(i=this.auth.currentUser)==null?void 0:i.uid;if(!t)throw new Error("User not authenticated");for(let c of e.trips)yield P(S(this.firestore,"trips"),v(E({},c),{user_id:t,parsed_at:new Date}))}}catch(e){throw console.error("Error parsing emails:",e),e}})}parseSpecificEmail(i){return p(this,null,function*(){var e;try{let t=yield this.http.post(`${I.apiUrl}/parse-email`,{config:this.EMAIL_CONFIG,emailId:i}).toPromise();if(t!=null&&t.success&&t.trip){let c=(e=this.auth.currentUser)==null?void 0:e.uid;if(!c)throw new Error("User not authenticated");yield P(S(this.firestore,"trips"),v(E({},t.trip),{user_id:c,parsed_at:new Date}))}}catch(t){throw console.error("Error parsing specific email:",t),t}})}};r.\u0275fac=function(e){return new(e||r)(g(k),g(O),g(U))},r.\u0275prov=x({token:r,factory:r.\u0275fac,providedIn:"root"});let n=r;return n})();function V(n,r){n&1&&(o(0,"div",6),h(1,"ion-spinner",7),o(2,"p"),l(3),u(4,"translate"),s()()),n&2&&(a(3),d(f(4,1,"EMAIL.PARSER.LOADING")))}function W(n,r){if(n&1&&(o(0,"div",8),h(1,"ion-icon",9),o(2,"p"),l(3),s()()),n&2){let J=w();a(3),d(J.error)}}function X(n,r){n&1&&(o(0,"div",10),h(1,"ion-icon",11),o(2,"p"),l(3),u(4,"translate"),s()()),n&2&&(a(3),d(f(4,1,"EMAIL.PARSER.SUCCESS")))}var pe=(()=>{let r=class r{constructor(i){this.emailParserService=i,this.loading=!1,this.error=null,this.success=!1}parseEmails(){return p(this,null,function*(){this.loading=!0,this.error=null,this.success=!1;try{yield this.emailParserService.parseUnreadEmails(),this.success=!0}catch(i){this.error=i instanceof Error?i.message:"Une erreur est survenue"}finally{this.loading=!1}})}toggleMenu(){let i=document.querySelector("ion-menu");i==null||i.toggle()}};r.\u0275fac=function(e){return new(e||r)(C(q))},r.\u0275cmp=y({type:r,selectors:[["app-email-parser"]],decls:14,vars:10,consts:[[3,"toggleMenu"],[1,"ion-padding"],["class","loading-spinner",4,"ngIf"],["class","error-message",4,"ngIf"],["class","success-message",4,"ngIf"],["expand","block",3,"click","disabled"],[1,"loading-spinner"],["name","crescent"],[1,"error-message"],["name","alert-circle","color","danger"],[1,"success-message"],["name","checkmark-circle","color","success"]],template:function(e,t){e&1&&(o(0,"app-user-status-bar",0),_("toggleMenu",function(){return t.toggleMenu()}),s(),o(1,"ion-content",1)(2,"ion-card")(3,"ion-card-header")(4,"ion-card-title"),l(5),u(6,"translate"),s()(),o(7,"ion-card-content"),M(8,V,5,3,"div",2)(9,W,4,1,"div",3)(10,X,5,3,"div",4),o(11,"ion-button",5),_("click",function(){return t.parseEmails()}),l(12),u(13,"translate"),s()()()()),e&2&&(a(5),d(f(6,6,"EMAIL.PARSER.TITLE")),a(3),m("ngIf",t.loading),a(),m("ngIf",t.error),a(),m("ngIf",t.success),a(),m("disabled",t.loading),a(),b(" ",f(13,8,"EMAIL.PARSER.PARSE_BUTTON")," "))},dependencies:[T,A,z,L,R,j,B,D,F,N,G,$,H],styles:[".loading-spinner[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:20px}.error-message[_ngcontent-%COMP%], .success-message[_ngcontent-%COMP%]{display:flex;align-items:center;gap:10px;padding:10px;margin:10px 0;border-radius:4px}.error-message[_ngcontent-%COMP%]{background-color:var(--ion-color-danger-tint);color:var(--ion-color-danger)}.success-message[_ngcontent-%COMP%]{background-color:var(--ion-color-success-tint);color:var(--ion-color-success)}"]});let n=r;return n})();export{pe as EmailParserPage};
