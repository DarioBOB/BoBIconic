import{a as fe}from"./chunk-77SYAVCL.js";import{a as _e}from"./chunk-PI2OKPQD.js";import{a as W}from"./chunk-AYIK34GE.js";import{B as pe,C as ge,E as ue,F as he,b as Q,c as X,f as Z,g as $,l as ee,m as te,n as ie,o as ne,p as ae,q as oe,r as re,v as se,w as le,x as de,y as ce,z as me}from"./chunk-V5B2KLGN.js";import{a as F}from"./chunk-F6L3CC75.js";import{F as U,O as B,P as H}from"./chunk-HLI2QS3U.js";import{$ as E,$a as q,Da as C,H as t,I as w,Ja as k,K as O,Oa as D,P as v,Pa as N,S as g,Sa as V,U as i,V as n,W as I,Ya as j,Za as z,_ as P,_a as G,aa as x,ab as K,db as Y,eb as J,ha as L,ia as r,ja as _,ka as M,ma as R,na as T,oa as A,ra as c,sa as m,w as h,x as f}from"./chunk-GCV73WN4.js";import"./chunk-PTOT3QKV.js";import"./chunk-B5GAGNNW.js";import"./chunk-7CZIZFFD.js";import"./chunk-IFM5WRZ2.js";import"./chunk-HC6MZPB3.js";import"./chunk-IP3IRUG3.js";import"./chunk-EX3LFGLF.js";import"./chunk-RMJ7PCZJ.js";import"./chunk-OFKYDT3Y.js";import"./chunk-SJBLRW5X.js";import"./chunk-JFFBAPXU.js";import"./chunk-MCRJI3T3.js";import"./chunk-BBW2JLGN.js";import"./chunk-B7L6ZJ5P.js";import"./chunk-KLLAU2Z6.js";import"./chunk-MGGEGWLF.js";import"./chunk-OAACOBQM.js";import"./chunk-JWIEPCRG.js";import"./chunk-HUAH4PE6.js";import"./chunk-SV7S5NYR.js";import"./chunk-C5RQ2IC2.js";import"./chunk-K5LNJG62.js";import"./chunk-THTBSZJO.js";import"./chunk-GNOVVPTF.js";import"./chunk-BAKMWPBW.js";import"./chunk-5OMUW5VI.js";import"./chunk-OBXDPQ3V.js";import{g as S}from"./chunk-OLRFWS6T.js";function Ee(o,p){o&1&&I(0,"ion-spinner",29)}function be(o,p){o&1&&(i(0,"span"),r(1),c(2,"translate"),n()),o&2&&(t(),_(m(2,1,"AUTH.LOGIN")))}function we(o,p){if(o&1&&(i(0,"ion-text",30)(1,"p",31),r(2),c(3,"translate"),n()()),o&2){let b=x();t(2),_(m(3,1,b.errorMessage))}}function Me(o,p){o&1&&(i(0,"p",35),r(1," (Mode test : pour cr\xE9er un compte, configurez une vraie cl\xE9 API Firebase dans environment.ts) "),n())}function Se(o,p){if(o&1&&(i(0,"ion-text",32)(1,"p",33),r(2),n(),v(3,Me,2,0,"p",34),n()),o&2){let b=x();t(2),_(b.errorMessageRaw),t(),g("ngIf",b.errorMessageRaw.includes("api-key-not-valid"))}}function Ie(o,p){if(o&1&&(i(0,"ion-text",36)(1,"p",31),r(2),c(3,"translate"),n()()),o&2){let b=x();t(2),_(m(3,1,b.successMessage))}}var He=(()=>{let p=class p{constructor(a,s,e,l,u){var d;this.auth=a,this.router=s,this.translate=e,this.demoService=l,this.alertCtrl=u,this.email="",this.password="",this.showPassword=!1,this.errorMessage="",this.errorMessageRaw="",this.isLoading=!1,this.selectedLang="fr",this.environment=_e,this.successMessage="",(d=this.router.events)==null||d.subscribe(y=>{y instanceof N&&y.url.includes("/auth/email")&&(this.email="",this.password="",this.errorMessage="")})}ngOnInit(){this.email="",this.password="",this.errorMessage="";let a=localStorage.getItem("lang"),s=navigator.language.split("-")[0];this.selectedLang=a||s||"fr",this.translate.use(this.selectedLang)}onLangChange(){this.translate.use(this.selectedLang),localStorage.setItem("lang",this.selectedLang)}login(){return S(this,null,function*(){if(!this.email||!this.password){this.errorMessage="AUTH.ERRORS.EMPTY_FIELDS",this.errorMessageRaw="";return}this.isLoading=!0,this.errorMessage="",this.errorMessageRaw="";try{this.demoService.deactivateDemo(),yield H(this.auth,this.email,this.password),this.router.navigate(["/landing"])}catch(a){switch(console.error("[AUTH ERROR]",a),a.code){case"auth/invalid-email":this.errorMessage="AUTH.ERRORS.INVALID_EMAIL";break;case"auth/user-disabled":this.errorMessage="AUTH.ERRORS.USER_DISABLED";break;case"auth/user-not-found":case"auth/invalid-credential":this.errorMessage="AUTH.ERRORS.USER_NOT_FOUND_BOB";break;case"auth/wrong-password":this.errorMessage="AUTH.ERRORS.INVALID_CREDENTIALS";break;case"auth/api-key-not-valid":this.errorMessage="AUTH.ERRORS.API_KEY_NOT_VALID",this.errorMessageRaw=a.message;break;default:this.errorMessage="AUTH.ERRORS.UNKNOWN",this.errorMessageRaw=a.message||JSON.stringify(a)}}finally{this.isLoading=!1}})}resetPassword(){return S(this,null,function*(){if(!this.email){this.errorMessage="AUTH.ERRORS.EMAIL_REQUIRED",this.successMessage="";return}this.isLoading=!0,this.errorMessage="",this.successMessage="";try{yield B(this.auth,this.email),this.successMessage="AUTH.RESET_EMAIL_SENT"}catch(a){switch(console.error("[RESET ERROR]",a),a.code){case"auth/invalid-email":this.errorMessage="AUTH.ERRORS.INVALID_EMAIL";break;case"auth/user-not-found":case"auth/invalid-credential":this.errorMessage="AUTH.ERRORS.USER_NOT_FOUND_BOB";break;default:this.errorMessage="AUTH.ERRORS.UNKNOWN"}}finally{this.isLoading=!1}})}togglePasswordVisibility(){this.showPassword=!this.showPassword}goToRegister(){this.router.navigate(["/auth/register"])}loadDemo(a){return S(this,null,function*(){if(console.log("[DEMO] loadDemo called with lang:",a),a){alert("[DEMO] Bouton langue cliqu\xE9: "+a),yield this.startDemo(a);return}let s=null,e=yield this.alertCtrl.create({header:"Choisissez la langue / Choose language",buttons:[{text:"Fran\xE7ais",handler:()=>{s="fr"}},{text:"English",handler:()=>{s="en"}}]});yield e.present(),yield e.onDidDismiss(),s&&(alert("[DEMO] Popup langue: "+s),yield this.startDemo(s))})}startDemo(a){return S(this,null,function*(){alert("[DEMO] startDemo: "+a),console.log("[DEMO] startDemo called with lang:",a),yield this.demoService.activateDemo(a),this.translate.use(a),alert("[DEMO] Navigation vers /landing"),this.router.navigate(["/landing"])})}};p.\u0275fac=function(s){return new(s||p)(w(U),w(V),w(F),w(W),w(ue))},p.\u0275cmp=O({type:p,selectors:[["app-email-auth"]],decls:63,vars:40,consts:[["loginForm","ngForm"],["slot","start"],["defaultHref","/auth"],[1,"ion-padding"],[2,"text-align","center","margin-bottom","8px"],["color","warning"],[3,"ngSubmit"],[2,"text-align","center","margin-bottom","16px"],["src","assets/bob/logo/bob-logo-circle.png","alt","BoB Logo",2,"height","70px","margin-bottom","8px"],[1,"bob-baseline"],["href","https://www.sunshine-adventures.net","target","_blank","rel","noopener"],["name","selectedLang","interface","popover",3,"ngModelChange","ionChange","ngModel"],["value","fr"],["value","en"],["position","floating"],["type","email","name","email","required","",3,"ngModelChange","ngModel"],["name","password","required","",3,"ngModelChange","type","ngModel"],["fill","clear","slot","end","type","button",3,"click"],[3,"name"],["expand","block","type","submit",3,"disabled"],["name","crescent",4,"ngIf"],[4,"ngIf"],["expand","block","fill","clear",3,"click","disabled"],["expand","block","fill","outline","type","button",3,"click","disabled"],[2,"display","flex","justify-content","center","gap","8px","margin-top","8px"],["size","small","color","secondary","fill","solid",3,"click"],["color","danger",4,"ngIf"],["color","medium",4,"ngIf"],["color","success",4,"ngIf"],["name","crescent"],["color","danger"],[1,"ion-text-center"],["color","medium"],[1,"ion-text-center",2,"font-size","0.9em"],["class","ion-text-center","style","font-size: 0.9em; color: orange;",4,"ngIf"],[1,"ion-text-center",2,"font-size","0.9em","color","orange"],["color","success"]],template:function(s,e){if(s&1){let l=P();i(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",1),I(3,"ion-back-button",2),n(),i(4,"ion-title"),r(5),c(6,"translate"),n()()(),i(7,"ion-content",3)(8,"div",4)(9,"ion-text",5)(10,"b"),r(11,"MODE TEST"),n()()(),i(12,"form",6,0),E("ngSubmit",function(){return h(l),f(e.login())}),i(14,"div",7),I(15,"img",8),i(16,"div",9),r(17),c(18,"translate"),i(19,"a",10),r(20,"www.sunshine-adventures.net"),n()()(),i(21,"ion-item")(22,"ion-label"),r(23),c(24,"translate"),n(),i(25,"ion-select",11),A("ngModelChange",function(d){return h(l),T(e.selectedLang,d)||(e.selectedLang=d),f(d)}),E("ionChange",function(){return h(l),f(e.onLangChange())}),i(26,"ion-select-option",12),r(27,"Fran\xE7ais"),n(),i(28,"ion-select-option",13),r(29,"English"),n()()(),i(30,"ion-list")(31,"ion-item")(32,"ion-label",14),r(33),c(34,"translate"),n(),i(35,"ion-input",15),A("ngModelChange",function(d){return h(l),T(e.email,d)||(e.email=d),f(d)}),n()(),i(36,"ion-item")(37,"ion-label",14),r(38),c(39,"translate"),n(),i(40,"ion-input",16),A("ngModelChange",function(d){return h(l),T(e.password,d)||(e.password=d),f(d)}),n(),i(41,"ion-button",17),E("click",function(){return h(l),f(e.togglePasswordVisibility())}),I(42,"ion-icon",18),n()()(),i(43,"div",3)(44,"ion-button",19),v(45,Ee,1,0,"ion-spinner",20)(46,be,3,3,"span",21),n(),i(47,"ion-button",22),E("click",function(){return h(l),f(e.resetPassword())}),r(48),c(49,"translate"),n(),i(50,"ion-button",23),E("click",function(){return h(l),f(e.goToRegister())}),r(51),c(52,"translate"),n(),i(53,"div",24)(54,"ion-button",25),E("click",function(){return h(l),f(e.loadDemo("fr"))}),r(55),c(56,"translate"),n(),i(57,"ion-button",25),E("click",function(){return h(l),f(e.loadDemo("en"))}),r(58),c(59,"translate"),n()()(),v(60,we,4,3,"ion-text",26)(61,Se,4,2,"ion-text",27)(62,Ie,4,3,"ion-text",28),n()()}if(s&2){let l=L(13);t(5),_(m(6,22,"AUTH.LOGIN_TITLE")),t(12),M(" ",m(18,24,"HOME.BASELINE")," "),t(6),_(m(24,26,"AUTH.PREFERRED_LANG")),t(2),R("ngModel",e.selectedLang),t(8),_(m(34,28,"AUTH.EMAIL")),t(2),R("ngModel",e.email),t(3),_(m(39,30,"AUTH.PASSWORD")),t(2),g("type",e.showPassword?"text":"password"),R("ngModel",e.password),t(2),g("name",e.showPassword?"eye-off":"eye"),t(2),g("disabled",!l.form.valid||e.isLoading),t(),g("ngIf",e.isLoading),t(),g("ngIf",!e.isLoading),t(),g("disabled",e.isLoading),t(),M(" ",m(49,32,"AUTH.FORGOT_PASSWORD")," "),t(2),g("disabled",e.isLoading),t(),M(" ",m(52,34,"AUTH.REGISTER")," "),t(4),M(" ",m(56,36,"HOME.TEST_APP")," "),t(3),M(" ",m(59,38,"HOME.TEST_APP")," "),t(2),g("ngIf",e.errorMessage),t(),g("ngIf",e.errorMessageRaw&&!e.environment.production),t(),g("ngIf",e.successMessage)}},dependencies:[k,C,he,Z,$,ee,te,ie,ne,ae,oe,re,se,le,de,ce,me,pe,Q,X,ge,J,K,j,z,Y,q,G,fe,D],styles:["ion-content[_ngcontent-%COMP%]{--background: none;background:url(/assets/bob/background/login_background.jpg) center center/cover no-repeat!important;min-height:100vh;display:flex;align-items:center;justify-content:center}form[_ngcontent-%COMP%]{max-width:400px;margin:48px auto;padding:32px 24px;background:#ffffffeb;border-radius:16px;box-shadow:0 2px 16px #00000014}ion-list[_ngcontent-%COMP%]{background:transparent;padding:0}ion-item[_ngcontent-%COMP%]{--background: transparent;--border-color: #1bb6b1;margin-bottom:16px}ion-button[_ngcontent-%COMP%]{--background: #1bb6b1;--background-hover: #159e9a;--background-activated: #159e9a;--color: #fff;--border-radius: 8px;margin-bottom:12px}ion-button[fill=outline][_ngcontent-%COMP%]{--background: #fff;--color: #1bb6b1;--border-color: #1bb6b1}ion-button[fill=clear][_ngcontent-%COMP%]{--color: #ff9800}ion-text[color=danger][_ngcontent-%COMP%]{margin-top:16px;display:block}"]});let o=p;return o})();export{He as EmailAuthPage};
